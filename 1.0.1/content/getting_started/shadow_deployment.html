<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Versioning and Shadow Deployment &mdash; Daeploy  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reaching a service from external applications" href="reaching_service_from_external_applications.html" />
    <link rel="prev" title="API Autodocs" href="autodocs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/daeploy_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/daeploy_description.html">Daeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/compatibility.html">Version compatibility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_service.html">Anatomy of a Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_logs.html">Read Logs From Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="autodocs.html">API Autodocs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Versioning and Shadow Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#deploying-a-shadow-service">Deploying a Shadow Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-main-service">Changing Main Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#killing-services">Killing Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reaching_service_from_external_applications.html">Reaching a service from external applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="ticker.html">Schedule Repeating Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring Your Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_service_communication.html">Cross-service Communication</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/sdk_typing.html">Typing in the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/using_multiple_hosts.html">Using Multiple Hosts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/email_notifications.html">Email Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/manager_api.html">Manager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/adv_deploy.html">Deployment Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/cli_autocompletion.html">Autocompletion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/service_environment.html">Service Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/manager_configuration.html">Manager Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/testing_services.html">Testing Services Before Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/proxy_dashboard.html">Proxy Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/upload_image.html">Upload local docker image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/status_codes.html">HTTP Status Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/integration_with_other_tools.html">Connecting Daeploy with Other Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/going_beyond_sdk.html">Going Beyond the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_tutorials/daeploy_notebook_service.html">Work With Daeploy From a Notebook</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Special Usecases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/deploying_ml_model.html">Deploying Machine Learning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_streamlit.html">Using Streamlit to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_plotly_dash.html">Using Plotly Dash to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/conda.html">Using Daeploy with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/gpu_services.html">Access NVIDIA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/hosting_static_html.html">Host static HTML pages using Daeploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Api Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/cli.html">Command-line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/sdk.html">Software Development Kit</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3rd_party_software.html">3rd party software</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Daeploy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Versioning and Shadow Deployment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/content/getting_started/shadow_deployment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="versioning-and-shadow-deployment">
<span id="versioning-shadow-reference"></span><h1>Versioning and Shadow Deployment<a class="headerlink" href="#versioning-and-shadow-deployment" title="Permalink to this heading"></a></h1>
<p>Daeploy supports something called shadow deployment, which means to deploy new versions
of a program “in the background” of an older version that is known to be stable.
This way, two or more services can run side by side and it becomes easy
to test new versions in an undisruptive manner, without risking crashes or
other unwanted behaviour in production.</p>
<p>This works by mirroring the input to every version of a service, but only
returning the response of the main verision.</p>
<section id="deploying-a-shadow-service">
<h2>Deploying a Shadow Service<a class="headerlink" href="#deploying-a-shadow-service" title="Permalink to this heading"></a></h2>
<p>Deploying a shadow service in Daeploy is as easy as deploying any other service.
When deploying a service for the first time, it will always be the main version
and every subsequent service with the same name will be a shadow of the main
service. Let’s try this out with the <cite>hello</cite> service we get from <code class="docutils literal notranslate"><span class="pre">daeploy</span> <span class="pre">init</span></code>:</p>
<p>(If you still have a <cite>hello</cite> service running from a previous tutorial,
you can skip to the third step)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daeploy</span> <span class="n">init</span> 
<span class="go">project_name [my_project]: hello</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daeploy</span> <span class="n">deploy</span> <span class="n">hello</span> <span class="mf">1.0.0</span> <span class="o">./</span><span class="n">hello</span> 
<span class="go">Active host: http://your-host</span>
<span class="go">Deploying service...</span>
<span class="go">Service deployed successfully</span>
<span class="go">MAIN    NAME    VERSION    STATUS    RUNNING</span>
<span class="go">------  ------  ---------  --------  -----------------------------------</span>
<span class="go">*       hello   1.0.0      running   Running (since 2020-11-23 11:30:00)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daeploy</span> <span class="n">deploy</span> <span class="n">hello</span> <span class="mf">2.0.0</span> <span class="o">./</span><span class="n">hello</span> 
<span class="go">Active host: http://your-host</span>
<span class="go">Deploying service...</span>
<span class="go">Service deployed successfully</span>
<span class="go">MAIN    NAME    VERSION    STATUS    RUNNING</span>
<span class="go">------  ------  ---------  --------  -----------------------------------</span>
<span class="go">        hello   2.0.0      running   Running (since 2020-11-23 11:31:44)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daeploy</span> <span class="n">ls</span> 
<span class="go">Active host: http://your-host</span>
<span class="go">MAIN    NAME    VERSION    STATUS    RUNNING</span>
<span class="go">------  ------  ---------  --------  -----------------------------------</span>
<span class="go">*       hello   1.0.0      running   Running (since 2020-11-23 11:30:00)</span>
<span class="go">        hello   2.0.0      running   Running (since 2020-11-23 11:31:44)</span>
</pre></div>
</div>
<p>The asterisk in the main column indicates that a service is the main version of
that service, otherwise it is a shadow. Each individual service can be reached at
<a class="reference external" href="http://your-host/services/name_version/">http://your-host/services/name_version/</a> and the shadow deployment setup is
reached at <a class="reference external" href="http://your-host/services/name/">http://your-host/services/name/</a>. At this URL, requests will be sent
to every running service with that name, but you will only get the response from
the main. Functionally, it is identical to communicating with the main directly.
This way it’s possible to use shadow deployment and still be able to communicate
with individual services.</p>
</section>
<section id="changing-main-service">
<h2>Changing Main Service<a class="headerlink" href="#changing-main-service" title="Permalink to this heading"></a></h2>
<p>When a new service seems to perform to a satisfactory level you can change it to
the main service using the CLI command <code class="docutils literal notranslate"><span class="pre">daeploy</span> <span class="pre">assign</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daeploy</span> <span class="n">assign</span> <span class="n">hello</span> <span class="mf">2.0.0</span> 
<span class="go">Active host: http://your-host</span>
<span class="go">Change hello 2.0.0 to main? [y/N]: y</span>
<span class="go">Changed main version to hello 2.0.0</span>
<span class="go">MAIN    NAME    VERSION    STATUS    RUNNING</span>
<span class="go">------  ------  ---------  --------  -----------------------------------</span>
<span class="go">        hello   1.0.0      running   Running (since 2020-11-23 11:30:00)</span>
<span class="go">*       hello   2.0.0      running   Running (since 2020-11-23 11:31:44)</span>
</pre></div>
</div>
<p>Now <cite>hello 2.0.0</cite> is the new main service and <cite>hello 1.0.0</cite> can be safely removed,
or kept running in the background and changed back to if there should be any
problems with the new version.</p>
</section>
<section id="killing-services">
<h2>Killing Services<a class="headerlink" href="#killing-services" title="Permalink to this heading"></a></h2>
<p>The user is prohibited from killing main services while it has shadows. This
is to protect the user from accidentally removing the main service and disrupting
the production system. Shadow services can be killed freely or all versions of a
service can be killed simultaneously with <code class="docutils literal notranslate"><span class="pre">daeploy</span> <span class="pre">kill</span> <span class="pre">&lt;name&gt;</span></code>. Main services
can be killed if they are the only service with that name.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="autodocs.html" class="btn btn-neutral float-left" title="API Autodocs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reaching_service_from_external_applications.html" class="btn btn-neutral float-right" title="Reaching a service from external applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Viking Analytics AB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 1.0.1
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../1.0.0/content/getting_started/shadow_deployment.html">1.0.0</a></dd>
      <dd><a href="../../../1.0.0-beta/content/getting_started/shadow_deployment.html">1.0.0-beta</a></dd>
      <dd><a href="shadow_deployment.html">1.0.1</a></dd>
      <dd><a href="../../../1.0.2/content/getting_started/shadow_deployment.html">1.0.2</a></dd>
      <dd><a href="../../../1.1.0/content/getting_started/shadow_deployment.html">1.1.0</a></dd>
      <dd><a href="../../../1.1.1/content/getting_started/shadow_deployment.html">1.1.1</a></dd>
      <dd><a href="../../../1.2.0/content/getting_started/shadow_deployment.html">1.2.0</a></dd>
      <dd><a href="../../../1.3.0/content/getting_started/shadow_deployment.html">1.3.0</a></dd>
      <dd><a href="../../../1.3.1/content/getting_started/shadow_deployment.html">1.3.1</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../develop/content/getting_started/shadow_deployment.html">develop</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing Services Before Deployment &mdash; Daeploy  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Proxy Dashboard" href="proxy_dashboard.html" />
    <link rel="prev" title="Manager Configuration" href="manager_configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/daeploy_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/daeploy_description.html">Daeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/compatibility.html">Version compatibility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/custom_service.html">Anatomy of a Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/service_logs.html">Read Logs From Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/autodocs.html">API Autodocs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/shadow_deployment.html">Versioning and Shadow Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/reaching_service_from_external_applications.html">Reaching a service from external applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ticker.html">Schedule Repeating Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/monitoring.html">Monitoring Your Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/cross_service_communication.html">Cross-service Communication</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sdk_typing.html">Typing in the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_multiple_hosts.html">Using Multiple Hosts</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager_api.html">Manager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="adv_deploy.html">Deployment Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_autocompletion.html">Autocompletion</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_environment.html">Service Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager_configuration.html">Manager Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing Services Before Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#writing-tests">Writing Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functions-that-do-not-work-locally">Functions That Do Not Work Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mocking-functions-to-run-services-locally">Mocking Functions to Run Services Locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-testing">More Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="proxy_dashboard.html">Proxy Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="going_beyond_sdk.html">Daeploy with FastAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="daeploy_notebook_service.html">Work With Daeploy From a Notebook</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Special Usecases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/deploying_ml_model.html">Deploying Machine Learning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_streamlit.html">Using Streamlit to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_plotly_dash.html">Using Plotly Dash to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/conda.html">Using Daeploy with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/gpu_services.html">Access NVIDIA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/hosting_static_html.html">Host static HTML pages using Daeploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Api Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/cli.html">Command-line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/sdk.html">Software Development Kit</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3rd_party_software.html">3rd party software</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Daeploy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Testing Services Before Deployment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/content/advanced_tutorials/testing_services.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="testing-services-before-deployment">
<span id="testing-services-reference"></span><h1>Testing Services Before Deployment<a class="headerlink" href="#testing-services-before-deployment" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>Iteratively debugging a service by repeatedly deploying and calling entrypoints
can become a somewhat slow and tedious process, having to wait a short time
for every deploy. To help ensure that services are in
a working state before deployment, we recommend that you use an automated
testing framework. When creating a new project with <code class="docutils literal notranslate"><span class="pre">daeploy</span> <span class="pre">init</span></code> a <cite>test/</cite>
directory is created. It contains two files: <cite>base_functionality_test.py</cite>
that performes base tests for things that are necessary for these services
to work, and <cite>user_tests.py</cite> for the user to add their own tests.</p>
<section id="writing-tests">
<h2>Writing Tests<a class="headerlink" href="#writing-tests" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>The tests use <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> which requires the
tests to lay in a folder called <cite>tests/</cite>, in modules that end with <cite>_test.py</cite>
and the names of the test functions should start with <cite>test_</cite>. Tests use the
<code class="docutils literal notranslate"><span class="pre">assert</span></code> statement to see if code behaves as expected. Let‚Äôs use the <cite>hello</cite>
service that is generated with <code class="docutils literal notranslate"><span class="pre">daeploy</span> <span class="pre">init</span></code> for an example test</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">daeploy</span> <span class="kn">import</span> <span class="n">service</span>
<span class="kn">from</span> <span class="nn">daeploy.communication</span> <span class="kn">import</span> <span class="n">notify</span><span class="p">,</span> <span class="n">Severity</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">service</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s2">&quot;greeting_phrase&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span>

<span class="nd">@service</span><span class="o">.</span><span class="n">entrypoint</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">greeting_phrase</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;greeting_phrase&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;World&quot;</span><span class="p">:</span>
        <span class="n">notify</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Someone is trying to greet the World, too time consuming. Skipping!&quot;</span><span class="p">,</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
            <span class="n">emails</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Greeting failed&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Greeting someone with the name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">greeting_phrase</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">service</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The output of the <code class="xref py py-func docutils literal notranslate"><span class="pre">hello()</span></code> function can be tested with the following function</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project_path&gt;/tests/user_tests</span>

<span class="k">def</span> <span class="nf">test_hello</span><span class="p">():</span>
    <span class="c1"># Test that service.hello(&quot;Bob&quot;) returns what is expected</span>
    <span class="k">assert</span> <span class="n">service</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Hello Bob&quot;</span>
</pre></div>
</div>
<p>We can run the tests using:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daeploy</span> <span class="n">test</span> <span class="o">&lt;</span><span class="n">project_path</span><span class="o">&gt;</span> 
</pre></div>
</div>
<p>Which is equivalent to:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">project_path</span><span class="o">&gt;</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="o">.</span> 
</pre></div>
</div>
</section>
<section id="functions-that-do-not-work-locally">
<h2>Functions That Do Not Work Locally<a class="headerlink" href="#functions-that-do-not-work-locally" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>There are three ways to run a Daeploy service. We have seen how to deploy and run
your services to a manager using <code class="docutils literal notranslate"><span class="pre">daeploy</span> <span class="pre">deploy</span></code> many times now, but you could also
run it with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">&lt;project_path&gt;/service.py</span></code> in which case it will be run as
it‚Äôs own webserver on localhost if <cite>service.py</cite> ends with
<code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.service.run()</span></code>. If it does not have <code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.service.run()</span></code>
it will behave like a normal python module and the functions therein can be used
however you‚Äôd like. The  <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> clause that surrounds
<code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.service.run()</span></code> allows us to import <cite>service.py</cite> freely and use it‚Äôs
functions. However, the SDK will only have full functionality if run on a manager.
The table below shows the SDK functions that cannot run locally without a manager:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 61%" />
<col style="width: 13%" />
<col style="width: 14%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Functions</p></td>
<td><p>Module</p></td>
<td><p>Localhost</p></td>
<td><p>Manager</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.call_service" title="daeploy.communication.call_service"><code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.communication.call_service()</span></code></a></p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.communication.notify()</span></code></a></p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.service.store()</span></code></p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.service.call_every()</span></code></p></td>
<td><p>No*</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>*Will not repeat without starting the service with <code class="xref py py-func docutils literal notranslate"><span class="pre">daeploy.service.run()</span></code>
but it won‚Äôt cause any errors</p>
</section>
<section id="mocking-functions-to-run-services-locally">
<h2>Mocking Functions to Run Services Locally<a class="headerlink" href="#mocking-functions-to-run-services-locally" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>To be able to test services that depend on some of the functions listed above, we
have to use something called mocking, which means to templorarily replace code to
do something else. In the case of the <cite>hello</cite> service we would get an error if
<a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">notify()</span></code></a> was called. We could mock
<a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">notify()</span></code></a> to do nothing and then check if it was called
to test that a notification would be posted to the manager. In <code class="xref py py-mod docutils literal notranslate"><span class="pre">daeploy.testing</span></code>
there is a function <code class="xref py py-func docutils literal notranslate"><span class="pre">patch()</span></code> that is included in Daeploy for
convenience from <code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest.mock</span></code> and is used for mocking</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project_path&gt;/tests/user_tests</span>
<span class="kn">import</span> <span class="nn">service</span>
<span class="kn">from</span> <span class="nn">daeploy.testing</span> <span class="kn">import</span> <span class="n">patch</span>


<span class="k">def</span> <span class="nf">test_notify_called</span><span class="p">():</span>
    <span class="c1"># Test that notify() is called when running service.hello(&quot;World&quot;)</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;service.notify&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">notify</span><span class="p">:</span>
        <span class="n">service</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
        <span class="n">notify</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
</pre></div>
</div>
<p>We import <cite>service.py</cite> and <code class="xref py py-func docutils literal notranslate"><span class="pre">patch()</span></code> and then in the test function
we create a session scope for the patch to revert the change back once we are done. In
<code class="xref py py-func docutils literal notranslate"><span class="pre">patch()</span></code> we give a path to the function to mock, in this case the
<a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">notify()</span></code></a> function that we imported in <cite>service.py</cite>. We can
then call the <code class="xref py py-func docutils literal notranslate"><span class="pre">hello()</span></code> function as normal and use the mock object
<code class="xref py py-obj docutils literal notranslate"><span class="pre">notify</span></code> to check if <a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">notify()</span></code></a> was called in
<code class="xref py py-func docutils literal notranslate"><span class="pre">service.hello()</span></code>. The process for mocking <code class="xref py py-func docutils literal notranslate"><span class="pre">store()</span></code> is
very similar, because neither <code class="xref py py-func docutils literal notranslate"><span class="pre">store()</span></code> or
<a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">notify()</span></code></a> have any return values.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">call_service()</span></code> on the other hand, will often have return values
and testing a service that uses it requires you to mock a problem specific return value.
Let‚Äôs take a look at an example service</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">daeploy</span> <span class="kn">import</span> <span class="n">service</span>
<span class="kn">from</span> <span class="nn">daeploy.communication</span> <span class="kn">import</span> <span class="n">call_service</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@service</span><span class="o">.</span><span class="n">entrypoint</span>
<span class="k">def</span> <span class="nf">ping_service</span><span class="p">(</span><span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pinging: </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">call_service</span><span class="p">(</span>
        <span class="n">service_name</span><span class="o">=</span><span class="n">service_name</span><span class="p">,</span>
        <span class="n">entrypoint_name</span><span class="o">=</span><span class="s2">&quot;ping&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">service</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This service has an entrypoint that pings another service to see if it is responding.
To create an automated test for this we need to mock <code class="xref py py-func docutils literal notranslate"><span class="pre">call_service()</span></code>
to return something that we would expect the <code class="xref py py-func docutils literal notranslate"><span class="pre">ping()</span></code> entrypoint of the target
service to return in a real scenario</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;project_path&gt;/tests/user_tests</span>
<span class="kn">import</span> <span class="nn">service</span>
<span class="kn">from</span> <span class="nn">daeploy.testing</span> <span class="kn">import</span> <span class="n">patch</span>


<span class="k">def</span> <span class="nf">test_ping_service</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;service.call_service&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">call_service</span><span class="p">:</span>
        <span class="n">call_service</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s2">&quot;Responding&quot;</span>
        <span class="n">service</span><span class="o">.</span><span class="n">ping_service</span><span class="p">(</span><span class="s2">&quot;test_service&quot;</span><span class="p">)</span>
        <span class="n">call_service</span><span class="o">.</span><span class="n">assert_called</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we mock <code class="xref py py-func docutils literal notranslate"><span class="pre">call_service()</span></code> in the same way as we did with
<a class="reference internal" href="../api_reference/sdk.html#daeploy.communication.notify" title="daeploy.communication.notify"><code class="xref py py-func docutils literal notranslate"><span class="pre">notify()</span></code></a> but we add a return value to the mock object
<code class="xref py py-obj docutils literal notranslate"><span class="pre">call_service</span></code> to make it return that when it is called in
<code class="xref py py-func docutils literal notranslate"><span class="pre">service.ping_service()</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">patch()</span></code> function returns an object of the
<a class="reference external" href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock">Mock</a>
class from <code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest.mock</span></code>.</p>
</div>
</section>
<section id="more-testing">
<h2>More Testing<a class="headerlink" href="#more-testing" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Refer to the <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> documentation and its
many addons if you would like to do more testing. To learn more about mocking and
the <code class="xref py py-func docutils literal notranslate"><span class="pre">patch()</span></code> function, take a look at
<a class="reference external" href="https://docs.python.org/3/library/unittest.mock.html">unittest.mock</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="manager_configuration.html" class="btn btn-neutral float-left" title="Manager Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="proxy_dashboard.html" class="btn btn-neutral float-right" title="Proxy Dashboard" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Viking Analytics AB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: develop
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../1.0.0/content/advanced_tutorials/testing_services.html">1.0.0</a></dd>
      <dd><a href="../../../1.0.0-beta/content/advanced_tutorials/testing_services.html">1.0.0-beta</a></dd>
      <dd><a href="../../../1.0.1/content/advanced_tutorials/testing_services.html">1.0.1</a></dd>
      <dd><a href="../../../1.0.2/content/advanced_tutorials/testing_services.html">1.0.2</a></dd>
      <dd><a href="../../../1.1.0/content/advanced_tutorials/testing_services.html">1.1.0</a></dd>
      <dd><a href="../../../1.1.1/content/advanced_tutorials/testing_services.html">1.1.1</a></dd>
      <dd><a href="../../../1.2.0/content/advanced_tutorials/testing_services.html">1.2.0</a></dd>
      <dd><a href="../../../1.3.0/content/advanced_tutorials/testing_services.html">1.3.0</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="testing_services.html">develop</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
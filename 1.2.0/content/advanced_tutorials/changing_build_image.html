<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Source to Image and Builder Images &mdash; Daeploy  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deploying Machine Learning Models" href="../special_usecases/deploying_ml_model.html" />
    <link rel="prev" title="Work With Daeploy From a Notebook" href="daeploy_notebook_service.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/daeploy_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/daeploy_description.html">Daeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/compatibility.html">Version compatibility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/custom_service.html">Anatomy of a Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/service_logs.html">Read Logs From Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/autodocs.html">API Autodocs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/shadow_deployment.html">Versioning and Shadow Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/reaching_service_from_external_applications.html">Reaching a service from external applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ticker.html">Schedule Repeating Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/monitoring.html">Monitoring Your Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/cross_service_communication.html">Cross-service Communication</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sdk_typing.html">Typing in the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_multiple_hosts.html">Using Multiple Hosts</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager_api.html">Manager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="adv_deploy.html">Deployment Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_autocompletion.html">Autocompletion</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_environment.html">Service Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager_configuration.html">Manager Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing_services.html">Testing Services Before Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy_dashboard.html">Proxy Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="upload_image.html">Upload local docker image</a></li>
<li class="toctree-l1"><a class="reference internal" href="status_codes.html">HTTP Status Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration_with_other_tools.html">Connecting Daeploy with Other Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="going_beyond_sdk.html">Going Beyond the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="daeploy_notebook_service.html">Work With Daeploy From a Notebook</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Source to Image and Builder Images</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#changing-builder-images">Changing Builder Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#injecting-additional-assembly-steps">Injecting Additional Assembly Steps</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Special Usecases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/deploying_ml_model.html">Deploying Machine Learning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_streamlit.html">Using Streamlit to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_plotly_dash.html">Using Plotly Dash to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/conda.html">Using Daeploy with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/gpu_services.html">Access NVIDIA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/hosting_static_html.html">Host static HTML pages using Daeploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Api Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/cli.html">Command-line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/sdk.html">Software Development Kit</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3rd_party_software.html">3rd party software</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Daeploy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Source to Image and Builder Images</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/content/advanced_tutorials/changing_build_image.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="source-to-image-and-builder-images">
<h1>Source to Image and Builder Images<a class="headerlink" href="#source-to-image-and-builder-images" title="Permalink to this heading"></a></h1>
<p>Daeploy uses something called <a class="reference external" href="https://github.com/openshift/source-to-image">Source to Image (S2I)</a> behind the hood to convert
source code to container images. S2I injects that source code into an existing
image, called a builder image, which it uses to produce a ready-to-run image.</p>
<p>There exists a number of ready-made builder images for python and we have
developed our own lightweight python builder images specifically for use with
Daeploy (<a class="reference external" href="https://github.com/vikinganalytics/daeploy-s2i-python">github link</a>).</p>
<section id="changing-builder-images">
<h2>Changing Builder Images<a class="headerlink" href="#changing-builder-images" title="Permalink to this heading"></a></h2>
<p>By default Daeploy uses a builder image based on ubuntu with python 3.8. There
can be situations, however, where that image might not be suitable. For
example if you want to use some library that is not supported for that version
of python, or if you need a certain OS.</p>
<p>To change the builder image you can use the <code class="docutils literal notranslate"><span class="pre">--build-image</span></code> option from the
deployment command in the CLI. We recommend using one of the custom made builder
images for Daeploy, but any python S2I builder images will work.</p>
</section>
<section id="injecting-additional-assembly-steps">
<h2>Injecting Additional Assembly Steps<a class="headerlink" href="#injecting-additional-assembly-steps" title="Permalink to this heading"></a></h2>
<p>If your application is dependent on software that need to be installed on the OS level,
it is not necessary to change the entire build image, but to instead add an additional step
to the existing build process.</p>
<p>The build process of S2I contains of three things:</p>
<ol class="arabic simple">
<li><p>A dockerfile</p></li>
<li><p>An assemble script</p></li>
<li><p>A run script</p></li>
</ol>
<p>The dockerfile is used to set up the OS and inject the source code into the
service. The <cite>assemble</cite> script is run after the dockerfile to set up the runtime
environment, e.g. installing required software and dependencies. The <cite>run</cite> script
starts the application after assembly. It will try to the file defined by the
<code class="docutils literal notranslate"><span class="pre">APP_SCRIPT</span></code> or <code class="docutils literal notranslate"><span class="pre">APP_FILE</span></code> environment variables.</p>
<p>Both the assemble and run scripts can be hooked into to add additional steps when
building or starting the service. To do this we add <cite>.s2i/bin/assemble</cite> or
<cite>.s2i/bin/run</cite> scripts in the service code.</p>
<p>An example of an <cite>assemble</cite> script could look like this:</p>
<blockquote>
<div><p>#!/bin/bash
# Running stock assemble script
${STI_SCRIPTS_PATH}/assemble
# Add additional assembly steps here</p>
</div></blockquote>
<p>And a <cite>run</cite> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
# Add additional run steps here

# Running stock run script
${STI_SCRIPTS_PATH}/run
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="daeploy_notebook_service.html" class="btn btn-neutral float-left" title="Work With Daeploy From a Notebook" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../special_usecases/deploying_ml_model.html" class="btn btn-neutral float-right" title="Deploying Machine Learning Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Viking Analytics AB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 1.2.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../1.0.0/index.html">1.0.0</a></dd>
      <dd><a href="../../../1.0.0-beta/index.html">1.0.0-beta</a></dd>
      <dd><a href="../../../1.0.1/index.html">1.0.1</a></dd>
      <dd><a href="../../../1.0.2/index.html">1.0.2</a></dd>
      <dd><a href="../../../1.1.0/index.html">1.1.0</a></dd>
      <dd><a href="../../../1.1.1/index.html">1.1.1</a></dd>
      <dd><a href="changing_build_image.html">1.2.0</a></dd>
      <dd><a href="../../../1.3.0/index.html">1.3.0</a></dd>
      <dd><a href="../../../1.3.1/index.html">1.3.1</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../develop/index.html">develop</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>